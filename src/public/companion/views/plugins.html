<h1>Your Plugins</h1>
<p>Here you can view every plugin connected to Freedeck and it's related button and key type!</p>
<button id="upd">Reload All Plugins</button>

<h2>Active</h2>
<ul id="actl" class="btnlist"></ul>
<div class="btns"></div>
<h2 id="disbl">Disabled</h2>
<div id="disbl-list" class="row"></div>

<h2>System Options</h2>
<div class="disabledable"></div>
<style>
    .disabledable,
    #disbl-list {
        display: flex;
        gap: 0.5rem;
    }
    .btns {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
    }
</style>

<script type="module">
    const seen = {};

    Object.keys(universal.plugins).forEach((plugin) => {
        const req = universal.plugins[plugin];
        const li = document.createElement('li');
        li.setAttribute('hovereffect', 'yes');
        li.style.cursor = 'default';
        if (seen[req.name]) return;
        seen[req.name] = true;
        li.innerText = `${req.name}${req.version ? ' v' + req.version : ''}` + ' - ' + req.id + ' by ' + req.author;
        const a = document.createElement('button');
        a.innerText = 'Disable ' + req.name;
        a.onclick = () => {
            universal.send(universal.events.default.disable_plugin, req.id);
        };
        document.querySelector('#actl').appendChild(li);

        document.querySelector('.disabledable').appendChild(a);
        const types = req.types;
        types.forEach((dataObj) => {
            const tmpBtn = document.createElement('button');
            tmpBtn.innerText = dataObj.name + ': ' + dataObj.type;
            tmpBtn.onclick = (ev) => {
                universal.send(universal.events.keypress, JSON.stringify({ event: ev, btn: { uuid: 0, name: dataObj.name, type: dataObj.type } }));
            };
            document.querySelector('.btns').appendChild(tmpBtn);
        });
    });

    universal._information.disabled.forEach((plugin) => {
        if (seen[plugin]) return;
        seen[plugin] = true;
        const a = document.createElement('button');
        a.innerText = 'Enable ' + plugin;
        a.onclick = () => {
            universal.uiSounds.playSound('int_confirm');
            universal.send(universal.events.default.enable_plugin, plugin);
            if (!dialog.open) dialog.showModal();
            dialog.innerHTML = `<p>Enabling ${plugin.split('.disabled')[0]}!</p>`;
        };
        document.querySelector('#disbl-list').appendChild(a);
    });

    
    
    universal.on(universal.events.default.plugin_downloaded, () => {
        dialog.innerHTML += `<p>Downloaded successfully. Give Freedeck a second to update it's plugin index.</p>`;
    });
    
    document.querySelector('#upd').onclick = () => {
        universal.uiSounds.playSound('int_yes');
        universal.send(universal.events.default.update_plugins);
        if (!dialog.open) dialog.showModal();
        dialog.innerHTML = `<p>Reloading plugins!</p>`;
    };
    const dialog = document.querySelector('dialog') || document.createElement('dialog');
    if(!document.querySelector('dialog')) document.body.appendChild(dialog);

</script>